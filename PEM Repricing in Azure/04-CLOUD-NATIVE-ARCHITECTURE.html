<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>04-CLOUD-NATIVE-ARCHITECTURE</title>
  <style>
    /* Default styles provided by pandoc.
    ** See https://pandoc.org/MANUAL.html#variables-for-html for config info.
    */
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
    <style>
    /* ========== FinThrive Theme Styles (Embedded) ========== */
/* Load Google Font */
@import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap');

body {
  font-family: 'Plus Jakarta Sans', sans-serif;
}
/* Typography Variables */
:root {
  /* Font Families */
  --font--headlines: 'Plus Jakarta Sans', sans-serif;
  --font--body-text: 'Plus Jakarta Sans', sans-serif;
  --font--accent: 'Plus Jakarta Sans', sans-serif;
  
  /* Font Weights */
  --weight--headlines: 500;
  --weight--body: normal;
  
  /* Display Sizes (Responsive) */
  --d-l: clamp(3.375rem, 4.464vi + 1.232rem, 5.250rem);
  --d-m: clamp(2.625rem, 5.060vi + 0.196rem, 4.750rem);
  --d-s: clamp(2.375rem, 2.381vi + 1.232rem, 3.375rem);
  --d-xs: clamp(2.375rem, 2.381vi + 1.232rem, 3.375rem);
  
  /* Heading Sizes (Responsive) */
  --h-xxl: clamp(2.375rem, 2.381vi + 1.232rem, 3.375rem);
  --h-xl: clamp(2.25rem, 0.893vi + 1.821rem, 2.625rem);
  --h-l: clamp(1.5rem, 1.786vi + 0.643rem, 2.250rem);
  --h-m: clamp(1.5rem, 0.595vi + 1.214rem, 1.750rem);
  --h-s: 1.3125rem;
  --h-xs: 1.125rem;
  
  /* Body Text Sizes */
  --b-l: clamp(1.25rem, 0.298vi + 1.107rem, 1.375rem);
  --b-m: 1.125rem;
  --b-s: 1.0rem;
  --b-xs: 0.875rem;
  
  /* Spacing Scale (Responsive) */
  --s-12: clamp(4.0rem, 20.238vi + -5.714rem, 12.500rem);
  --s-11: clamp(3.0rem, 16.667vi + -5.000rem, 10.000rem);
  --s-10: clamp(3.0rem, 11.905vi + -2.714rem, 8.000rem);
  --s-9: clamp(2.375rem, 8.631vi + -1.768rem, 6.000rem);
  --s-8: clamp(2.375rem, 3.869vi + 0.518rem, 4.000rem);
  --s-7: clamp(2.0rem, 2.381vi + 0.857rem, 3.000rem);
  --s-6: clamp(2.0rem, 0.595vi + 1.714rem, 2.250rem);
  --s-5: clamp(1.125rem, 0.893vi + 0.696rem, 1.500rem);
  --s-4: 1.125rem;
  --s-3: 0.75rem;
  --s-2: 0.5rem;
  --s-1: 0.25rem;
  --s-0: 0.0rem;
}

/* Light Mode Color Theme (Default) */
:root,
.light-mode {
  /* Primary Colors */
  --primary: #00E091;
  --primary--medium: #80F2C3;
  --primary--light: #C0F9E1;
  --primary--extra-light: #EBFBF7;
  --primary--dark: #005654;
  
  /* Secondary Colors */
  --secondary: #FF9B5C;
  --secondary--medium: #F87A3A;
  --secondary--light: #FFCA98;
  --secondary--extra-light: #fff2e5;
  --secondary--dark: #663E25;
  
  /* Tertiary Colors */
  --tertiary: #3E69FA;
  --tertiary--medium: #3356CC;
  --tertiary--light: #CAD6FF;
  --tertiary--dark: #13204D;
  
  /* Accent Color */
  --accent: #9efb21;
  
  /* Neutral Colors */
  --neutral--black: #005654;
  --neutral--dark: #005654;
  --neutral--medium-dark: #545757;
  --neutral--medium: #A8ABAB;
  --neutral--medium-light: #D4D6D6;
  --neutral--light: #F5F5F5;
  --neutral--white: #FFFFFF;
  
  /* Neutral Color Transparency Variants */
  --neutral--dark-80: rgba(0, 86, 84, 0.8);
  --neutral--dark-60: rgba(0, 86, 84, 0.6);
  --neutral--dark-40: rgba(0, 86, 84, 0.4);
  --neutral--dark-20: rgba(0, 86, 84, 0.2);
  --neutral--dark-10: rgba(0, 86, 84, 0.1);
  --neutral--white-80: rgba(255, 255, 255, 0.8);
  --neutral--white-60: rgba(255, 255, 255, 0.6);
  --neutral--white-40: rgba(255, 255, 255, 0.4);
  --neutral--white-20: rgba(255, 255, 255, 0.2);
  --neutral--white-10: rgba(255, 255, 255, 0.1);
  
  /* Card Styles */
  --card-border: var(--neutral--medium-light);
  --card-background-light: var(--neutral--white);
  --card-background-dark: var(--neutral--dark);
  --card-border-hover: var(--neutral--medium-dark);
  
  /* Input Styles */
  --input--border: var(--neutral--medium);
  --input--border-focused: var(--inline-links);
  --input--border-active: var(--neutral--medium-dark);
  --input--border-disabled: var(--neutral--medium-light);
  
  /* Text Colors */
  --headlines: #005654;
  --text: #005654;
  --text--80: rgba(0, 86, 84, 0.8);
  --text--60: rgba(0, 86, 84, 0.6);
  --text-input: #005654;
  
  /* UI Elements */
  --hr: var(--neutral--medium-light);
  
  /* Link Colors */
  --inline-links: #3254c8;
  --inline-links--hover: #7393FF;
  --inline-links--visited: #8C3EFA;
  --menu-links: #005654;
  --menu-links--hover: #00E091;
  --menu-links--active: #005654;
  
  /* Primary Button */
  --btn--primary-fg: var(--neutral--white);
  --btn--primary-fg-hover: var(--neutral--white);
  --btn--primary-bg: var(--primary);
  --btn--primary-bg-hover: var(--primary--medium);
  --btn--primary-stroke: var(--primary--dark);
  
  /* Secondary Button */
  --btn--secondary-fg: var(--neutral--white);
  --btn--secondary-fg-hover: var(--neutral--white);
  --btn--secondary-bg: var(--secondary);
  --btn--secondary-bg-hover: var(--secondary--medium);
  --btn--secondary-stroke: var(--neutral-dark);
  
  /* Tertiary Button */
  --btn--tertiary-fg: var(--neutral--white);
  --btn--tertiary-fg-hover: var(--neutral--white);
  --btn--tertiary-bg: var(--tertiary);
  --btn--tertiary-bg-hover: var(--tertiary--medium);
  --btn--tertiary-stroke: var(--neutral-dark);
  
  /* White Button */
  --btn--white-fg: var(--primary);
  --btn--white-fg-hover: var(--neutral--white);
  --btn--white-bg: var(--neutral--white);
  --btn--white-bg-hover: var(--primary);
  --btn--white-stroke: var(--neutral--white);
  
  color: var(--text);
}

/* Dark Mode Color Theme */
.dark-mode {
  /* Text Colors */
  --headlines: #FFFFFF;
  --text: #FFFFFF;
  --text-input: #FFFFFF;
  
  /* UI Elements */
  --hr: var(--neutral--medium-dark);
  
  /* Link Colors */
  --inline-links: #FFFFFF;
  --inline-links--hover: #70BAFE;
  --inline-links--visited: #FFFFFF;
  --menu-links: #FFFFFF;
  --menu-links--hover: #C0F9E1;
  --menu-links--active: #FFFFFF;
  
  /* Card Styles */
  --card-border: var(--neutral--white);
  --card-background-light: var(--neutral--light);
  --card-border-hover: var(--neutral--white);
  
  /* Button Strokes */
  --btn--primary-stroke: var(--neutral--white);
  --btn--secondary-stroke: var(--neutral--white);
  --btn--tertiary-stroke: var(--neutral--white);
  
  color: var(--text);
}

/* ========== Table Styles ========== */

table {
  width: 100%;
  border-collapse: collapse;
  margin: var(--s-5) 0;
  font-size: var(--b-s);
  font-family: var(--font--body-text);
  background-color: var(--neutral--white);
  border: 1px solid var(--neutral--medium-light);
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 1px 3px rgba(0, 86, 84, 0.08);
}

/* Table Header */
thead {
  background-color: var(--primary--extra-light);
}

thead tr {
  border-bottom: 2px solid var(--primary--medium);
}

th {
  padding: var(--s-3) var(--s-4);
  text-align: left;
  font-weight: var(--weight--headlines);
  color: var(--primary--dark);
  font-size: var(--b-s);
  letter-spacing: 0.02em;
  white-space: nowrap;
}

/* Table Body */
tbody tr {
  border-bottom: 1px solid var(--neutral--medium-light);
  transition: background-color 0.15s ease;
}

tbody tr:last-child {
  border-bottom: none;
}

/* Zebra Striping */
tbody tr:nth-child(even) {
  background-color: var(--neutral--light);
}

tbody tr:nth-child(odd) {
  background-color: var(--neutral--white);
}

/* Row Hover Effect */
tbody tr:hover {
  background-color: var(--primary--extra-light);
}

/* Table Cells */
td {
  padding: var(--s-3) var(--s-4);
  color: var(--text);
  vertical-align: top;
  line-height: 1.5;
}

/* Code in Table Cells */
td code,
th code {
  background-color: var(--neutral--light);
  padding: 0.15em 0.4em;
  border-radius: 4px;
  font-size: 0.9em;
  color: var(--tertiary--dark);
  font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
}

/* Bold text in first column */
td:first-child strong,
td strong {
  color: var(--primary--dark);
  font-weight: 600;
}

/* Column Groups - ensure proper column widths */
colgroup col {
  min-width: 80px;
}

/* Responsive Table Wrapper */
@media screen and (max-width: 768px) {
  table {
    display: block;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
  
  th, td {
    min-width: 120px;
    padding: var(--s-2) var(--s-3);
    font-size: var(--b-xs);
  }
}

/* Dark Mode Table Styles */
.dark-mode table {
  background-color: var(--neutral--dark);
  border-color: var(--neutral--medium-dark);
}

.dark-mode thead {
  background-color: rgba(0, 224, 145, 0.15);
}

.dark-mode thead tr {
  border-bottom-color: var(--primary--medium);
}

.dark-mode th {
  color: var(--primary--medium);
}

.dark-mode tbody tr:nth-child(even) {
  background-color: rgba(255, 255, 255, 0.05);
}

.dark-mode tbody tr:nth-child(odd) {
  background-color: transparent;
}

.dark-mode tbody tr:hover {
  background-color: rgba(0, 224, 145, 0.1);
}

.dark-mode tbody tr {
  border-bottom-color: var(--neutral--medium-dark);
}

.dark-mode td {
  color: var(--text);
}

.dark-mode td code,
.dark-mode th code {
  background-color: rgba(255, 255, 255, 0.1);
  color: var(--primary--light);
}

/* ========== Additional Layout Styles ========== */

/* Body max-width and padding for readability */
body {
  max-width: 1200px;
  margin: 0 auto;
  padding: var(--s-6) var(--s-5);
  line-height: 1.6;
  background-color: var(--neutral--white);
}

/* Headings */
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font--headlines);
  font-weight: var(--weight--headlines);
  color: var(--headlines);
  margin-top: var(--s-6);
  margin-bottom: var(--s-4);
  line-height: 1.3;
}

h1 {
  font-size: var(--h-xxl);
  color: var(--primary--dark);
  border-bottom: 3px solid var(--primary);
  padding-bottom: var(--s-3);
  margin-bottom: var(--s-5);
}

h2 {
  font-size: var(--h-xl);
  color: var(--primary--dark);
  border-bottom: 2px solid var(--primary--medium);
  padding-bottom: var(--s-2);
}

h3 {
  font-size: var(--h-l);
  color: var(--primary--dark);
}

h4 {
  font-size: var(--h-m);
}

h5 {
  font-size: var(--h-s);
}

h6 {
  font-size: var(--h-xs);
}

/* Horizontal Rules */
hr {
  border: none;
  border-top: 2px solid var(--hr);
  margin: var(--s-6) 0;
}

/* Paragraphs */
p {
  margin-bottom: var(--s-4);
  font-size: var(--b-m);
}

/* Links */
a {
  color: var(--inline-links);
  text-decoration: none;
  transition: color 0.15s ease;
}

a:hover {
  color: var(--inline-links--hover);
  text-decoration: underline;
}

a:visited {
  color: var(--inline-links--visited);
}

/* Blockquotes */
blockquote {
  border-left: 4px solid var(--primary);
  background-color: var(--primary--extra-light);
  padding: var(--s-4) var(--s-5);
  margin: var(--s-5) 0;
  border-radius: 0 8px 8px 0;
}

blockquote p {
  margin-bottom: 0;
}

/* Lists */
ul, ol {
  margin-bottom: var(--s-4);
  padding-left: var(--s-5);
}

li {
  margin-bottom: var(--s-2);
  line-height: 1.6;
}

/* Nested lists */
ul ul, ol ol, ul ol, ol ul {
  margin-top: var(--s-2);
  margin-bottom: 0;
}

/* Task Lists */
ul.task-list {
  list-style: none;
  padding-left: 0;
}

ul.task-list li {
  padding-left: var(--s-1);
}

/* Inline code */
code {
  background-color: var(--neutral--light);
  padding: 0.15em 0.4em;
  border-radius: 4px;
  font-size: 0.9em;
  color: var(--tertiary--dark);
  font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
}

/* Code blocks */
pre {
  background-color: #f8f9fa;
  color: #333333;
  border: 1px solid var(--neutral--medium-light);
  padding: var(--s-4);
  border-radius: 8px;
  overflow-x: auto;
  margin: var(--s-5) 0;
  font-size: var(--b-xs);
  line-height: 1.5;
}

pre code {
  background-color: transparent;
  padding: 0;
  color: inherit;
}

/* Mermaid diagrams */
.mermaid {
  margin: var(--s-5) 0;
  text-align: center;
  background-color: var(--neutral--white);
  padding: var(--s-4);
  border-radius: 8px;
  border: 1px solid var(--neutral--medium-light);
}
  </style>
  <!-- ========== Prism.JS Syntax Highlighting ========== -->

  <!-- Prism theme (choose one theme below) -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism.css"
  />

  <!-- Core Prism library -->
  <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script>

  <!-- Add languages you need -->
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-csharp.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-json.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-sql.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-typescript.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-yaml.js"></script>

  <!-- Automatically highlight code after page load -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      if (window.Prism) {
        Prism.highlightAll();
      }
    });
  </script>

  <!-- ========== Mermaid Rendering ========== -->

  <!-- Use stable UMD build -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Find code blocks that came from ```mermaid fences
      const mermaidCodeBlocks = document.querySelectorAll(
        'pre.mermaid > code, pre > code.language-mermaid'
      );

      mermaidCodeBlocks.forEach(code => {
        const pre = code.parentElement;
        const parent = pre?.parentElement;
        if (!pre || !parent) return;

        const text = (code.textContent || '').trim();
        if (!text) return;

        // Replace <pre><code> with <div class="mermaid">...</div>
        const div = document.createElement('div');
        div.className = 'mermaid';
        div.textContent = text;

        parent.replaceChild(div, pre);
      });

      mermaid.initialize({
        startOnLoad: true
      });
    });
  </script>
  <!-- Navigation CSS and JS -->
  <link rel="stylesheet" href="navigation.css" />
  <script src="navigation.js" defer></script>
  <script src="/auth-check.js"></script>
</head>
<body>
<h1 id="phase-2-cloud-native-architecture">Phase 2: Cloud-Native
Architecture</h1>
<p><strong>Version:</strong> 1.0<br />
<strong>Last Updated:</strong> January 16, 2026<br />
<strong>Author:</strong> Andy Bratton<br />
<strong>Status:</strong> Future Planning</p>
<hr />
<h2 id="overview">Overview</h2>
<p>Phase 2 rewrites the pricing engine as cloud-native .NET 10
microservices, eliminating native C++ dependencies and enabling:</p>
<ul>
<li>✅ <strong>Linux Containers</strong> - Smaller images, faster
startup, lower cost</li>
<li>✅ <strong>Independent Scaling</strong> - Scale each pricer type
separately</li>
<li>✅ <strong>Modern Patterns</strong> - Event-driven, stateless,
testable</li>
<li>✅ <strong>Easier Maintenance</strong> - Pure .NET codebase</li>
</ul>
<blockquote>
<p><strong>Prerequisites</strong>: Phase 1 must be complete and stable
before beginning Phase 2.</p>
</blockquote>
<hr />
<h2 id="target-architecture">Target Architecture</h2>
<pre><code>┌───────────────────────────┐
│ EXTERNAL SYSTEMS          │
│  • Claim Sources          │────────────┐
└───────────────────────────┘            │
                                         ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                                   AZURE                                      │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │ API GATEWAY: API Management                                             │ │
│  └──────────────────────────────────┬─────────────────────────────────────┘ │
│                                     ▼                                        │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │ INGESTION LAYER                                                         │ │
│  │  ┌───────────────────────┐  ┌───────────────────────┐                   │ │
│  │  │ Service Bus           │→ │ Validation Service    │                   │ │
│  │  │ (claims-ingest)       │  │                       │                   │ │
│  │  └───────────────────────┘  └───────────┬───────────┘                   │ │
│  └──────────────────────────────────────────┼──────────────────────────────┘ │
│                                             ▼                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐│
│  │ PRICING DOMAIN (Linux Containers)                                        ││
│  │  ┌─────────────────────────────────────────────────────────────────────┐ ││
│  │  │ Pricing Router                                                       │ ││
│  │  └───────────┬──────────────────┬──────────────────┬───────────────────┘ ││
│  │              ▼                  ▼                  ▼                      ││
│  │  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐        ││
│  │  │ MEDICARE PRICERS │  │ MEDICAID PRICERS │  │ COMMERCIAL       │        ││
│  │  │ • Medicare IP    │  │ • Arizona        │  │ • TAC Engine     │        ││
│  │  │ • Medicare OP    │  │ • South Carolina │  │   (.NET 10)      │        ││
│  │  │ (.NET 10)        │  │ • Other States   │  │                  │        ││
│  │  └────────┬─────────┘  └──────────────────┘  └────────┬─────────┘        ││
│  └───────────┼───────────────────────────────────────────┼──────────────────┘│
│              ▼                                           │                   │
│  ┌───────────────────────────────────┐                   │                   │
│  │ GROUPING SERVICES                 │                   │                   │
│  │  ┌─────────────┐  ┌─────────────┐ │                   │                   │
│  │  │DRG Grouper  │  │APC Grouper  │ │                   │                   │
│  │  │(.NET 10)    │  │(.NET 10)    │ │                   │                   │
│  │  └──────┬──────┘  └──────┬──────┘ │                   │                   │
│  └─────────┼────────────────┼────────┘                   │                   │
│            ▼                ▼                            ▼                   │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │ DATA LAYER                                                             │  │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐        │  │
│  │  │ Redis           │  │ Azure SQL       │  │ Cosmos DB       │        │  │
│  │  │ (Reference Data)│  │ (Contracts/TAC) │  │ (Claims/Results)│        │  │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘        │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                     │                                        │
│                                     ▼                                        │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │ OUTPUT                                                                 │  │
│  │  ┌───────────────────────┐  ┌───────────────────────┐                 │  │
│  │  │ Service Bus           │→ │ PEM Episode API       │                 │  │
│  │  │ (claims-priced)       │  │                       │                 │  │
│  │  └───────────────────────┘  └───────────────────────┘                 │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────┘</code></pre>
<hr />
<h2 id="service-definitions">Service Definitions</h2>
<h3 id="pricing-router-service">1. Pricing Router Service</h3>
<p><strong>Purpose</strong>: Route claims to appropriate pricing service
based on payer/program.</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Name</strong></td>
<td><code>pricing-router</code></td>
</tr>
<tr>
<td><strong>Runtime</strong></td>
<td>.NET 10 Minimal API</td>
</tr>
<tr>
<td><strong>Container</strong></td>
<td>Linux (Alpine)</td>
</tr>
<tr>
<td><strong>Image Size</strong></td>
<td>~80 MB</td>
</tr>
<tr>
<td><strong>Scaling</strong></td>
<td>2-20 replicas</td>
</tr>
</tbody>
</table>
<p><strong>Routing Logic</strong>:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> PricingRouter <span class="op">:</span> IPricingRouter</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> PricerType <span class="fu">DetermineRoute</span><span class="op">(</span>ClaimInput claim<span class="op">)</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> claim<span class="op">.</span><span class="fu">Payer</span><span class="op">.</span><span class="fu">PayerType</span> <span class="kw">switch</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>            PayerType<span class="op">.</span><span class="fu">MedicarePartA</span> when claim<span class="op">.</span><span class="fu">ClaimType</span> <span class="op">==</span> ClaimType<span class="op">.</span><span class="fu">Inpatient</span> </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                <span class="op">=&gt;</span> PricerType<span class="op">.</span><span class="fu">MedicareInpatient</span><span class="op">,</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>            PayerType<span class="op">.</span><span class="fu">MedicarePartA</span> when claim<span class="op">.</span><span class="fu">ClaimType</span> <span class="op">==</span> ClaimType<span class="op">.</span><span class="fu">Outpatient</span> </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>                <span class="op">=&gt;</span> PricerType<span class="op">.</span><span class="fu">MedicareOutpatient</span><span class="op">,</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>            PayerType<span class="op">.</span><span class="fu">MedicarePartB</span> </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>                <span class="op">=&gt;</span> PricerType<span class="op">.</span><span class="fu">MedicarePhysician</span><span class="op">,</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>            PayerType<span class="op">.</span><span class="fu">Medicaid</span> </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>                <span class="op">=&gt;</span> <span class="fu">DetermineMedicaidRoute</span><span class="op">(</span>claim<span class="op">.</span><span class="fu">Payer</span><span class="op">.</span><span class="fu">State</span><span class="op">),</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>            PayerType<span class="op">.</span><span class="fu">TRICARE</span> </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">=&gt;</span> PricerType<span class="op">.</span><span class="fu">Tricare</span><span class="op">,</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>            _ <span class="op">=&gt;</span> PricerType<span class="op">.</span><span class="fu">Commercial</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<hr />
<h3 id="medicare-inpatient-pricing-service">2. Medicare Inpatient
Pricing Service</h3>
<p><strong>Purpose</strong>: Calculate IPPS-based payment for inpatient
claims.</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Name</strong></td>
<td><code>medicare-ip-pricer</code></td>
</tr>
<tr>
<td><strong>Runtime</strong></td>
<td>.NET 10</td>
</tr>
<tr>
<td><strong>Source</strong></td>
<td>Port from <code>lib-medicare-inpatient-core</code></td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>DRG Grouper Service, Redis</td>
</tr>
</tbody>
</table>
<p><strong>API</strong>:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">interface</span> IMedicareInpatientPricer</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    Task<span class="op">&lt;</span>IppsResult<span class="op">&gt;</span> <span class="fu">CalculatePriceAsync</span><span class="op">(</span>InpatientClaim claim<span class="op">,</span> FiscalYear fy<span class="op">);</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> record <span class="fu">IppsResult</span><span class="op">(</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> DrgCode<span class="op">,</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">decimal</span> DrgWeight<span class="op">,</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">decimal</span> BasePayment<span class="op">,</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">decimal</span> WageAdjustedPayment<span class="op">,</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">decimal</span> OutlierPayment<span class="op">,</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">decimal</span> TotalPayment<span class="op">,</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    IReadOnlyList<span class="op">&lt;</span>PaymentComponent<span class="op">&gt;</span> Components</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="op">);</span></span></code></pre></div>
<p><strong>Calculation Flow</strong>:</p>
<pre><code>Inpatient Claim → DRG Grouping → Get DRG Weight → Base Payment → Wage Index Adjustment → Outlier Calculation → Transfer Adjustment → Final Payment</code></pre>
<hr />
<h3 id="medicare-outpatient-pricing-service">3. Medicare Outpatient
Pricing Service</h3>
<p><strong>Purpose</strong>: Calculate OPPS-based payment for outpatient
claims.</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Name</strong></td>
<td><code>medicare-op-pricer</code></td>
</tr>
<tr>
<td><strong>Runtime</strong></td>
<td>.NET 10</td>
</tr>
<tr>
<td><strong>Source</strong></td>
<td>Port from <code>lib-medicare-outpatient-core</code></td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>APC Grouper Service, Redis</td>
</tr>
</tbody>
</table>
<p><strong>Calculation Components</strong>: - APC assignment per line -
Status indicator processing - Packaging rules - Composite APC logic -
Pass-through payments - Outlier calculations</p>
<hr />
<h3 id="drg-grouper-service">4. DRG Grouper Service</h3>
<p><strong>Purpose</strong>: Group inpatient claims to MS-DRG.</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Name</strong></td>
<td><code>drg-grouper</code></td>
</tr>
<tr>
<td><strong>Runtime</strong></td>
<td>.NET 10</td>
</tr>
<tr>
<td><strong>Source</strong></td>
<td>Port from C++ <code>HDRGGrouper</code></td>
</tr>
<tr>
<td><strong>Scaling</strong></td>
<td>CPU-intensive; 2-10 replicas</td>
</tr>
</tbody>
</table>
<p><strong>Options for Implementation</strong>:</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Pros</th>
<th>Cons</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Port to .NET</strong></td>
<td>Pure managed code, Linux</td>
<td>Significant effort</td>
</tr>
<tr>
<td><strong>3M Service</strong></td>
<td>Already exists</td>
<td>External dependency, cost</td>
</tr>
<tr>
<td><strong>Wrap Native DLL</strong></td>
<td>Uses proven logic</td>
<td>Windows containers only</td>
</tr>
</tbody>
</table>
<p><strong>Recommended</strong>: Use 3M GP Services API initially, then
evaluate .NET port.</p>
<hr />
<h3 id="apc-grouper-service">5. APC Grouper Service</h3>
<p><strong>Purpose</strong>: Group outpatient lines to APCs.</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Name</strong></td>
<td><code>apc-grouper</code></td>
</tr>
<tr>
<td><strong>Runtime</strong></td>
<td>.NET 10</td>
</tr>
<tr>
<td><strong>Source</strong></td>
<td><code>FinThrive.APCGrouper</code> NuGet (already .NET)</td>
</tr>
<tr>
<td><strong>Scaling</strong></td>
<td>2-10 replicas</td>
</tr>
</tbody>
</table>
<p><strong>Advantage</strong>: APC grouper is already .NET managed code,
minimal porting needed.</p>
<hr />
<h3 id="tac-engine-service">6. TAC Engine Service</h3>
<p><strong>Purpose</strong>: Evaluate Terms &amp; Conditions for
commercial pricing.</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Name</strong></td>
<td><code>tac-engine</code></td>
</tr>
<tr>
<td><strong>Runtime</strong></td>
<td>.NET 10</td>
</tr>
<tr>
<td><strong>Source</strong></td>
<td>New development based on TAC models</td>
</tr>
<tr>
<td><strong>Complexity</strong></td>
<td><strong>HIGH</strong> - hundreds of term types</td>
</tr>
</tbody>
</table>
<p><strong>TAC Term Types to Support</strong>:</p>
<table>
<thead>
<tr>
<th>Category</th>
<th>Examples</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>DRG-Based</strong></td>
<td>DRG case rate, DRG percent of charges</td>
</tr>
<tr>
<td><strong>Per Diem</strong></td>
<td>Per diem rate, tiered per diem</td>
</tr>
<tr>
<td><strong>Percent of Charges</strong></td>
<td>Discount from charges</td>
</tr>
<tr>
<td><strong>Fee Schedule</strong></td>
<td>CPT-based fee schedule</td>
</tr>
<tr>
<td><strong>Carve-Outs</strong></td>
<td>Implants, drugs, high-cost items</td>
</tr>
<tr>
<td><strong>Stop-Loss</strong></td>
<td>Outlier thresholds</td>
</tr>
</tbody>
</table>
<p><strong>Phased Approach</strong>: 1. <strong>Phase 2A</strong>:
Support top 10 most-used term types 2. <strong>Phase 2B</strong>: Add
remaining term types iteratively 3. <strong>Phase 2C</strong>: Full
parity with legacy TAC engine</p>
<hr />
<h2 id="data-architecture">Data Architecture</h2>
<h3 id="reference-data-caching">Reference Data Caching</h3>
<pre><code>┌─────────────────────────────────────────────────────────────────────────────┐
│ DATA SOURCES                                                                 │
│  ┌─────────────────────────┐  ┌─────────────────────────┐                   │
│  │ CMS Files               │  │ Contract DB             │                   │
│  │ (Annual Updates)        │  │                         │                   │
│  └───────────┬─────────────┘  └───────────┬─────────────┘                   │
└──────────────┼────────────────────────────┼─────────────────────────────────┘
               │                            │
               └──────────────┬─────────────┘
                              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│ DATA LOADER                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │ Reference Data Import Job                                                ││
│  └──────────────────────────────────┬──────────────────────────────────────┘│
└─────────────────────────────────────┼───────────────────────────────────────┘
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│ REDIS CACHE                                                                  │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │DRG Weights  │  │APC Rates    │  │Wage Indices │  │Fee Schedules│         │
│  │(TTL: 24h)   │  │(TTL: 24h)   │  │(TTL: 24h)   │  │(TTL: 24h)   │         │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘  └─────────────┘         │
└─────────┼────────────────┼────────────────┼─────────────────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│ PRICING SERVICES                                                             │
│  ┌─────────────────────────────┐  ┌─────────────────────────────┐           │
│  │ Medicare IP                 │  │ Medicare OP                 │           │
│  │ (reads DRG Weights, Wage)   │  │ (reads APC Rates)           │           │
│  └─────────────────────────────┘  └─────────────────────────────┘           │
└─────────────────────────────────────────────────────────────────────────────┘</code></pre>
<h3 id="redis-cache-schema">Redis Cache Schema</h3>
<pre><code># DRG Weights
drg:weights:fy2026:{drgCode} → { weight: 1.2345, avgLos: 4.5, ... }

# APC Rates  
apc:rates:cy2026:{apcCode} → { payment: 234.56, status: &quot;S&quot;, ... }

# Wage Indices
wage:index:fy2026:{cbsa} → { wageIndex: 1.0234, rural: false }

# Fee Schedules
fee:mpfs:cy2026:{cptCode}:{locality} → { allowable: 123.45 }

# Contract Terms (with longer TTL)
contract:{contractId}:tac → { ... serialized TAC model ... }</code></pre>
<hr />
<h2 id="api-contracts">API Contracts</h2>
<h3 id="claim-input-schema">Claim Input Schema</h3>
<div class="sourceCode" id="cb7"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> record ClaimInput</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> ClaimId <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> FacilityId <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> ClaimType ClaimType <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> BillType <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> DateOnly AdmitDate <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> DateOnly DischargeDate <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> PatientStatus <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Diagnosis PrincipalDiagnosis <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> IReadOnlyList<span class="op">&lt;</span>Diagnosis<span class="op">&gt;</span> SecondaryDiagnoses <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> IReadOnlyList<span class="op">&lt;</span>Procedure<span class="op">&gt;</span> Procedures <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> IReadOnlyList<span class="op">&lt;</span>RevenueLine<span class="op">&gt;</span> RevenueLines <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Payer Payer <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Provider AttendingProvider <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">decimal</span> TotalCharges <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="pricing-result-schema">Pricing Result Schema</h3>
<div class="sourceCode" id="cb8"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> record PricingResult</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> ClaimId <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> PricerType PricerUsed <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> DateTimeOffset PricedAt <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Grouping Results</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span><span class="op">?</span> DrgCode <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">decimal</span><span class="op">?</span> DrgWeight <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> IReadOnlyList<span class="op">&lt;</span>ApcAssignment<span class="op">&gt;?</span> ApcAssignments <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Payment Results</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">decimal</span> ExpectedPayment <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">decimal</span> AllowedAmount <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> IReadOnlyList<span class="op">&lt;</span>PaymentComponent<span class="op">&gt;</span> Components <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Audit</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> IReadOnlyList<span class="op">&lt;</span>PricingNote<span class="op">&gt;</span> Notes <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span><span class="op">?</span> TraceXml <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> record <span class="fu">PaymentComponent</span><span class="op">(</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> ComponentType<span class="op">,</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> Description<span class="op">,</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">decimal</span> Amount<span class="op">,</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span><span class="op">?</span> Code <span class="op">=</span> <span class="kw">null</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="op">);</span></span></code></pre></div>
<hr />
<h2 id="service-communication">Service Communication</h2>
<h3 id="event-driven-pipeline">Event-Driven Pipeline</h3>
<p><strong>Sequence:</strong></p>
<table>
<thead>
<tr>
<th>Step</th>
<th>From</th>
<th>To</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Service Bus</td>
<td>Router</td>
<td>ClaimSubmitted event</td>
</tr>
<tr>
<td>2</td>
<td>Router</td>
<td>Router</td>
<td>Determine route</td>
</tr>
<tr>
<td>3</td>
<td>Router</td>
<td>Service Bus</td>
<td>ClaimRouted → medicare-ip-queue</td>
</tr>
<tr>
<td>4</td>
<td>Service Bus</td>
<td>Pricer</td>
<td>Process claim</td>
</tr>
<tr>
<td>5</td>
<td>Pricer</td>
<td>Grouper</td>
<td>GroupToDrgAsync</td>
</tr>
<tr>
<td>6</td>
<td>Grouper</td>
<td>Redis</td>
<td>Get DRG data</td>
</tr>
<tr>
<td>7</td>
<td>Redis</td>
<td>Grouper</td>
<td>DRG weight returned</td>
</tr>
<tr>
<td>8</td>
<td>Grouper</td>
<td>Pricer</td>
<td>DRG result</td>
</tr>
<tr>
<td>9</td>
<td>Pricer</td>
<td>Redis</td>
<td>Get wage index</td>
</tr>
<tr>
<td>10</td>
<td>Redis</td>
<td>Pricer</td>
<td>Wage data returned</td>
</tr>
<tr>
<td>11</td>
<td>Pricer</td>
<td>Pricer</td>
<td>Calculate payment</td>
</tr>
<tr>
<td>12</td>
<td>Pricer</td>
<td>Service Bus</td>
<td>ClaimPriced → results-queue</td>
</tr>
<tr>
<td>13</td>
<td>Pricer</td>
<td>Cosmos DB</td>
<td>Store result</td>
</tr>
</tbody>
</table>
<pre><code>Service Bus → Router → Service Bus → Pricer ⟷ Grouper ⟷ Redis → Service Bus + Cosmos DB</code></pre>
<h3 id="grpc-for-synchronous-calls">gRPC for Synchronous Calls</h3>
<div class="sourceCode" id="cb10"><pre
class="sourceCode protobuf"><code class="sourceCode protobuf"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">// drg_grouper.proto</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>syntax <span class="op">=</span> <span class="st">&quot;proto3&quot;</span>;</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="kw">service</span> DrgGrouper {</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">rpc</span> GroupToDrg(DrgGroupRequest) <span class="kw">returns</span> (DrgGroupResponse);</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="kw">message</span> DrgGroupRequest {</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> principal_diagnosis <span class="op">=</span> <span class="dv">1</span>;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">repeated</span> <span class="dt">string</span> secondary_diagnoses <span class="op">=</span> <span class="dv">2</span>;</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">repeated</span> Procedure procedures <span class="op">=</span> <span class="dv">3</span>;</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32</span> age <span class="op">=</span> <span class="dv">4</span>;</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> sex <span class="op">=</span> <span class="dv">5</span>;</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> discharge_status <span class="op">=</span> <span class="dv">6</span>;</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="kw">message</span> DrgGroupResponse {</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> drg_code <span class="op">=</span> <span class="dv">1</span>;</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> drg_description <span class="op">=</span> <span class="dv">2</span>;</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> drg_weight <span class="op">=</span> <span class="dv">3</span>;</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32</span> mdc <span class="op">=</span> <span class="dv">4</span>;</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> drg_type <span class="op">=</span> <span class="dv">5</span>;  <span class="co">// Medical, Surgical, etc.</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h2 id="deployment-architecture">Deployment Architecture</h2>
<h3 id="kubernetes-manifests">Kubernetes Manifests</h3>
<div class="sourceCode" id="cb11"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pricing-router-deployment.yaml</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apps/v1</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Deployment</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> pricing-router</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> pem-pricing</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">replicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">selector</span><span class="kw">:</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">matchLabels</span><span class="kw">:</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">app</span><span class="kw">:</span><span class="at"> pricing-router</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">app</span><span class="kw">:</span><span class="at"> pricing-router</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> pricing-router</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">image</span><span class="kw">:</span><span class="at"> acr-pem.azurecr.io/pricing-router:latest</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">containerPort</span><span class="kw">:</span><span class="at"> </span><span class="dv">8080</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">requests</span><span class="kw">:</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;250m&quot;</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;256Mi&quot;</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">limits</span><span class="kw">:</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;1000m&quot;</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;512Mi&quot;</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">livenessProbe</span><span class="kw">:</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">httpGet</span><span class="kw">:</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">path</span><span class="kw">:</span><span class="at"> /health/live</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">port</span><span class="kw">:</span><span class="at"> </span><span class="dv">8080</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">initialDelaySeconds</span><span class="kw">:</span><span class="at"> </span><span class="dv">10</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">periodSeconds</span><span class="kw">:</span><span class="at"> </span><span class="dv">30</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">readinessProbe</span><span class="kw">:</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">httpGet</span><span class="kw">:</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">path</span><span class="kw">:</span><span class="at"> /health/ready</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">port</span><span class="kw">:</span><span class="at"> </span><span class="dv">8080</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">initialDelaySeconds</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">periodSeconds</span><span class="kw">:</span><span class="at"> </span><span class="dv">10</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> ASPNETCORE_ENVIRONMENT</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;Production&quot;</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> ServiceBus__ConnectionString</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">valueFrom</span><span class="kw">:</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">secretKeyRef</span><span class="kw">:</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">name</span><span class="kw">:</span><span class="at"> servicebus-secret</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">key</span><span class="kw">:</span><span class="at"> connection-string</span></span></code></pre></div>
<hr />
<h2 id="migration-path-from-phase-1">Migration Path from Phase 1</h2>
<h3 id="parallel-running">Parallel Running</h3>
<pre><code>                     ┌──────────────────────────────────────────┐
                     │ INCOMING CLAIMS                          │
                     │  ┌────────────────────────────────────┐  │
                     │  │ Claims Queue                       │  │
                     │  └─────────────────┬──────────────────┘  │
                     └────────────────────┼─────────────────────┘
                                          ▼
                     ┌──────────────────────────────────────────┐
                     │ TRAFFIC SPLITTER                         │
                     │  ┌────────────────────────────────────┐  │
                     │  │ Route by Flag                      │  │
                     │  └───────┬───────────────┬────────────┘  │
                     └──────────┼───────────────┼───────────────┘
                        90%     │               │    10% + Shadow
              ┌─────────────────┘               └─────────────────┐
              ▼                                                   ▼
┌──────────────────────────────┐            ┌──────────────────────────────┐
│ PHASE 1 (Windows)            │            │ PHASE 2 (Linux)              │
│  ┌────────────────────────┐  │            │  ┌────────────────────────┐  │
│  │ Containerized Legacy   │  │            │  │ Cloud-Native Services  │  │
│  │ Engine                 │  │            │  │                        │  │
│  └───────────┬────────────┘  │            │  └───────────┬────────────┘  │
└──────────────┼───────────────┘            └──────────────┼───────────────┘
               │                                           │
               └─────────────────┬─────────────────────────┘
                                 ▼
                     ┌──────────────────────────────────────────┐
                     │ COMPARISON                               │
                     │  ┌────────────────────────────────────┐  │
                     │  │ Result Comparator                  │──│─→ Log Differences → Cosmos DB
                     │  └────────────────────────────────────┘  │
                     └──────────────────────────────────────────┘</code></pre>
<h3 id="gradual-traffic-shift">Gradual Traffic Shift</h3>
<table>
<thead>
<tr>
<th>Week</th>
<th>Phase 1</th>
<th>Phase 2</th>
<th>Validation</th>
</tr>
</thead>
<tbody>
<tr>
<td>1-2</td>
<td>100%</td>
<td>Shadow only</td>
<td>Compare all results</td>
</tr>
<tr>
<td>3-4</td>
<td>90%</td>
<td>10%</td>
<td>Monitor errors</td>
</tr>
<tr>
<td>5-6</td>
<td>70%</td>
<td>30%</td>
<td>Performance validation</td>
</tr>
<tr>
<td>7-8</td>
<td>50%</td>
<td>50%</td>
<td>Full validation</td>
</tr>
<tr>
<td>9-10</td>
<td>20%</td>
<td>80%</td>
<td>Final checks</td>
</tr>
<tr>
<td>11-12</td>
<td>0%</td>
<td>100%</td>
<td>Phase 1 deprecated</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="timeline-estimate">Timeline Estimate</h2>
<table>
<colgroup>
<col style="width: 24%" />
<col style="width: 34%" />
<col style="width: 41%" />
</colgroup>
<thead>
<tr>
<th>Phase</th>
<th>Duration</th>
<th>Activities</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Design</strong></td>
<td>4 weeks</td>
<td>API contracts, data models, service boundaries</td>
</tr>
<tr>
<td><strong>Infrastructure</strong></td>
<td>2 weeks</td>
<td>AKS setup, Redis, Service Bus</td>
</tr>
<tr>
<td><strong>Core Services</strong></td>
<td>8 weeks</td>
<td>Router, Medicare IP/OP, Groupers</td>
</tr>
<tr>
<td><strong>Medicaid/Commercial</strong></td>
<td>8 weeks</td>
<td>State pricers, TAC engine (partial)</td>
</tr>
<tr>
<td><strong>Integration</strong></td>
<td>4 weeks</td>
<td>PEM integration, E2E testing</td>
</tr>
<tr>
<td><strong>Migration</strong></td>
<td>4 weeks</td>
<td>Parallel running, traffic shift</td>
</tr>
<tr>
<td><strong>TAC Completion</strong></td>
<td>8 weeks</td>
<td>Remaining TAC term types</td>
</tr>
</tbody>
</table>
<p><strong>Total Estimate</strong>: 38-42 weeks (with TAC
completion)</p>
<hr />
<h2 id="risks-mitigations">Risks &amp; Mitigations</h2>
<table>
<colgroup>
<col style="width: 23%" />
<col style="width: 30%" />
<col style="width: 46%" />
</colgroup>
<thead>
<tr>
<th>Risk</th>
<th>Impact</th>
<th>Mitigation</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>DRG Grouper Port</strong></td>
<td>High complexity</td>
<td>Use 3M service initially</td>
</tr>
<tr>
<td><strong>TAC Complexity</strong></td>
<td>Hundreds of term types</td>
<td>Phased implementation</td>
</tr>
<tr>
<td><strong>Parity Drift</strong></td>
<td>Results differ from CM</td>
<td>Extensive parity testing</td>
</tr>
<tr>
<td><strong>Performance</strong></td>
<td>HTTP overhead</td>
<td>gRPC for hot paths</td>
</tr>
<tr>
<td><strong>Data Consistency</strong></td>
<td>Stale reference data</td>
<td>Event-driven cache refresh</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="success-criteria">Success Criteria</h2>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Target</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Parity</strong></td>
<td>100% match with Phase 1</td>
</tr>
<tr>
<td><strong>Throughput</strong></td>
<td>≥1,000 claims/second</td>
</tr>
<tr>
<td><strong>Latency</strong></td>
<td>&lt;100ms p95</td>
</tr>
<tr>
<td><strong>Container Size</strong></td>
<td>&lt;200 MB per service</td>
</tr>
<tr>
<td><strong>Startup Time</strong></td>
<td>&lt;10 seconds</td>
</tr>
<tr>
<td><strong>Cost Reduction</strong></td>
<td>50% vs Phase 1 Windows containers</td>
</tr>
</tbody>
</table>
<hr />
<p><strong>Document Status:</strong> ✅ Complete<br />
<strong>Prerequisites:</strong> Phase 1 stable in production</p>
</body>
</html>
