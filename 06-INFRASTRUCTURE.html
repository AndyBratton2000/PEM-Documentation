<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>06-INFRASTRUCTURE</title>
  <style>
    /* Default styles provided by pandoc.
    ** See https://pandoc.org/MANUAL.html#variables-for-html for config info.
    */
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
    <style>
    /* ========== FinThrive Theme Styles (Embedded) ========== */
/* Load Google Font */
@import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap');

body {
  font-family: 'Plus Jakarta Sans', sans-serif;
}
/* Typography Variables */
:root {
  /* Font Families */
  --font--headlines: 'Plus Jakarta Sans', sans-serif;
  --font--body-text: 'Plus Jakarta Sans', sans-serif;
  --font--accent: 'Plus Jakarta Sans', sans-serif;
  
  /* Font Weights */
  --weight--headlines: 500;
  --weight--body: normal;
  
  /* Display Sizes (Responsive) */
  --d-l: clamp(3.375rem, 4.464vi + 1.232rem, 5.250rem);
  --d-m: clamp(2.625rem, 5.060vi + 0.196rem, 4.750rem);
  --d-s: clamp(2.375rem, 2.381vi + 1.232rem, 3.375rem);
  --d-xs: clamp(2.375rem, 2.381vi + 1.232rem, 3.375rem);
  
  /* Heading Sizes (Responsive) */
  --h-xxl: clamp(2.375rem, 2.381vi + 1.232rem, 3.375rem);
  --h-xl: clamp(2.25rem, 0.893vi + 1.821rem, 2.625rem);
  --h-l: clamp(1.5rem, 1.786vi + 0.643rem, 2.250rem);
  --h-m: clamp(1.5rem, 0.595vi + 1.214rem, 1.750rem);
  --h-s: 1.3125rem;
  --h-xs: 1.125rem;
  
  /* Body Text Sizes */
  --b-l: clamp(1.25rem, 0.298vi + 1.107rem, 1.375rem);
  --b-m: 1.125rem;
  --b-s: 1.0rem;
  --b-xs: 0.875rem;
  
  /* Spacing Scale (Responsive) */
  --s-12: clamp(4.0rem, 20.238vi + -5.714rem, 12.500rem);
  --s-11: clamp(3.0rem, 16.667vi + -5.000rem, 10.000rem);
  --s-10: clamp(3.0rem, 11.905vi + -2.714rem, 8.000rem);
  --s-9: clamp(2.375rem, 8.631vi + -1.768rem, 6.000rem);
  --s-8: clamp(2.375rem, 3.869vi + 0.518rem, 4.000rem);
  --s-7: clamp(2.0rem, 2.381vi + 0.857rem, 3.000rem);
  --s-6: clamp(2.0rem, 0.595vi + 1.714rem, 2.250rem);
  --s-5: clamp(1.125rem, 0.893vi + 0.696rem, 1.500rem);
  --s-4: 1.125rem;
  --s-3: 0.75rem;
  --s-2: 0.5rem;
  --s-1: 0.25rem;
  --s-0: 0.0rem;
}

/* Light Mode Color Theme (Default) */
:root,
.light-mode {
  /* Primary Colors */
  --primary: #00E091;
  --primary--medium: #80F2C3;
  --primary--light: #C0F9E1;
  --primary--extra-light: #EBFBF7;
  --primary--dark: #005654;
  
  /* Secondary Colors */
  --secondary: #FF9B5C;
  --secondary--medium: #F87A3A;
  --secondary--light: #FFCA98;
  --secondary--extra-light: #fff2e5;
  --secondary--dark: #663E25;
  
  /* Tertiary Colors */
  --tertiary: #3E69FA;
  --tertiary--medium: #3356CC;
  --tertiary--light: #CAD6FF;
  --tertiary--dark: #13204D;
  
  /* Accent Color */
  --accent: #9efb21;
  
  /* Neutral Colors */
  --neutral--black: #005654;
  --neutral--dark: #005654;
  --neutral--medium-dark: #545757;
  --neutral--medium: #A8ABAB;
  --neutral--medium-light: #D4D6D6;
  --neutral--light: #F5F5F5;
  --neutral--white: #FFFFFF;
  
  /* Neutral Color Transparency Variants */
  --neutral--dark-80: rgba(0, 86, 84, 0.8);
  --neutral--dark-60: rgba(0, 86, 84, 0.6);
  --neutral--dark-40: rgba(0, 86, 84, 0.4);
  --neutral--dark-20: rgba(0, 86, 84, 0.2);
  --neutral--dark-10: rgba(0, 86, 84, 0.1);
  --neutral--white-80: rgba(255, 255, 255, 0.8);
  --neutral--white-60: rgba(255, 255, 255, 0.6);
  --neutral--white-40: rgba(255, 255, 255, 0.4);
  --neutral--white-20: rgba(255, 255, 255, 0.2);
  --neutral--white-10: rgba(255, 255, 255, 0.1);
  
  /* Card Styles */
  --card-border: var(--neutral--medium-light);
  --card-background-light: var(--neutral--white);
  --card-background-dark: var(--neutral--dark);
  --card-border-hover: var(--neutral--medium-dark);
  
  /* Input Styles */
  --input--border: var(--neutral--medium);
  --input--border-focused: var(--inline-links);
  --input--border-active: var(--neutral--medium-dark);
  --input--border-disabled: var(--neutral--medium-light);
  
  /* Text Colors */
  --headlines: #005654;
  --text: #005654;
  --text--80: rgba(0, 86, 84, 0.8);
  --text--60: rgba(0, 86, 84, 0.6);
  --text-input: #005654;
  
  /* UI Elements */
  --hr: var(--neutral--medium-light);
  
  /* Link Colors */
  --inline-links: #3254c8;
  --inline-links--hover: #7393FF;
  --inline-links--visited: #8C3EFA;
  --menu-links: #005654;
  --menu-links--hover: #00E091;
  --menu-links--active: #005654;
  
  /* Primary Button */
  --btn--primary-fg: var(--neutral--white);
  --btn--primary-fg-hover: var(--neutral--white);
  --btn--primary-bg: var(--primary);
  --btn--primary-bg-hover: var(--primary--medium);
  --btn--primary-stroke: var(--primary--dark);
  
  /* Secondary Button */
  --btn--secondary-fg: var(--neutral--white);
  --btn--secondary-fg-hover: var(--neutral--white);
  --btn--secondary-bg: var(--secondary);
  --btn--secondary-bg-hover: var(--secondary--medium);
  --btn--secondary-stroke: var(--neutral-dark);
  
  /* Tertiary Button */
  --btn--tertiary-fg: var(--neutral--white);
  --btn--tertiary-fg-hover: var(--neutral--white);
  --btn--tertiary-bg: var(--tertiary);
  --btn--tertiary-bg-hover: var(--tertiary--medium);
  --btn--tertiary-stroke: var(--neutral-dark);
  
  /* White Button */
  --btn--white-fg: var(--primary);
  --btn--white-fg-hover: var(--neutral--white);
  --btn--white-bg: var(--neutral--white);
  --btn--white-bg-hover: var(--primary);
  --btn--white-stroke: var(--neutral--white);
  
  color: var(--text);
}

/* Dark Mode Color Theme */
.dark-mode {
  /* Text Colors */
  --headlines: #FFFFFF;
  --text: #FFFFFF;
  --text-input: #FFFFFF;
  
  /* UI Elements */
  --hr: var(--neutral--medium-dark);
  
  /* Link Colors */
  --inline-links: #FFFFFF;
  --inline-links--hover: #70BAFE;
  --inline-links--visited: #FFFFFF;
  --menu-links: #FFFFFF;
  --menu-links--hover: #C0F9E1;
  --menu-links--active: #FFFFFF;
  
  /* Card Styles */
  --card-border: var(--neutral--white);
  --card-background-light: var(--neutral--light);
  --card-border-hover: var(--neutral--white);
  
  /* Button Strokes */
  --btn--primary-stroke: var(--neutral--white);
  --btn--secondary-stroke: var(--neutral--white);
  --btn--tertiary-stroke: var(--neutral--white);
  
  color: var(--text);
}

/* ========== Table Styles ========== */

table {
  width: 100%;
  border-collapse: collapse;
  margin: var(--s-5) 0;
  font-size: var(--b-s);
  font-family: var(--font--body-text);
  background-color: var(--neutral--white);
  border: 1px solid var(--neutral--medium-light);
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 1px 3px rgba(0, 86, 84, 0.08);
}

/* Table Header */
thead {
  background-color: var(--primary--extra-light);
}

thead tr {
  border-bottom: 2px solid var(--primary--medium);
}

th {
  padding: var(--s-3) var(--s-4);
  text-align: left;
  font-weight: var(--weight--headlines);
  color: var(--primary--dark);
  font-size: var(--b-s);
  letter-spacing: 0.02em;
  white-space: nowrap;
}

/* Table Body */
tbody tr {
  border-bottom: 1px solid var(--neutral--medium-light);
  transition: background-color 0.15s ease;
}

tbody tr:last-child {
  border-bottom: none;
}

/* Zebra Striping */
tbody tr:nth-child(even) {
  background-color: var(--neutral--light);
}

tbody tr:nth-child(odd) {
  background-color: var(--neutral--white);
}

/* Row Hover Effect */
tbody tr:hover {
  background-color: var(--primary--extra-light);
}

/* Table Cells */
td {
  padding: var(--s-3) var(--s-4);
  color: var(--text);
  vertical-align: top;
  line-height: 1.5;
}

/* Code in Table Cells */
td code,
th code {
  background-color: var(--neutral--light);
  padding: 0.15em 0.4em;
  border-radius: 4px;
  font-size: 0.9em;
  color: var(--tertiary--dark);
  font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
}

/* Bold text in first column */
td:first-child strong,
td strong {
  color: var(--primary--dark);
  font-weight: 600;
}

/* Column Groups - ensure proper column widths */
colgroup col {
  min-width: 80px;
}

/* Responsive Table Wrapper */
@media screen and (max-width: 768px) {
  table {
    display: block;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
  
  th, td {
    min-width: 120px;
    padding: var(--s-2) var(--s-3);
    font-size: var(--b-xs);
  }
}

/* Dark Mode Table Styles */
.dark-mode table {
  background-color: var(--neutral--dark);
  border-color: var(--neutral--medium-dark);
}

.dark-mode thead {
  background-color: rgba(0, 224, 145, 0.15);
}

.dark-mode thead tr {
  border-bottom-color: var(--primary--medium);
}

.dark-mode th {
  color: var(--primary--medium);
}

.dark-mode tbody tr:nth-child(even) {
  background-color: rgba(255, 255, 255, 0.05);
}

.dark-mode tbody tr:nth-child(odd) {
  background-color: transparent;
}

.dark-mode tbody tr:hover {
  background-color: rgba(0, 224, 145, 0.1);
}

.dark-mode tbody tr {
  border-bottom-color: var(--neutral--medium-dark);
}

.dark-mode td {
  color: var(--text);
}

.dark-mode td code,
.dark-mode th code {
  background-color: rgba(255, 255, 255, 0.1);
  color: var(--primary--light);
}

/* ========== Additional Layout Styles ========== */

/* Body max-width and padding for readability */
body {
  max-width: 1200px;
  margin: 0 auto;
  padding: var(--s-6) var(--s-5);
  line-height: 1.6;
  background-color: var(--neutral--white);
}

/* Headings */
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font--headlines);
  font-weight: var(--weight--headlines);
  color: var(--headlines);
  margin-top: var(--s-6);
  margin-bottom: var(--s-4);
  line-height: 1.3;
}

h1 {
  font-size: var(--h-xxl);
  color: var(--primary--dark);
  border-bottom: 3px solid var(--primary);
  padding-bottom: var(--s-3);
  margin-bottom: var(--s-5);
}

h2 {
  font-size: var(--h-xl);
  color: var(--primary--dark);
  border-bottom: 2px solid var(--primary--medium);
  padding-bottom: var(--s-2);
}

h3 {
  font-size: var(--h-l);
  color: var(--primary--dark);
}

h4 {
  font-size: var(--h-m);
}

h5 {
  font-size: var(--h-s);
}

h6 {
  font-size: var(--h-xs);
}

/* Horizontal Rules */
hr {
  border: none;
  border-top: 2px solid var(--hr);
  margin: var(--s-6) 0;
}

/* Paragraphs */
p {
  margin-bottom: var(--s-4);
  font-size: var(--b-m);
}

/* Links */
a {
  color: var(--inline-links);
  text-decoration: none;
  transition: color 0.15s ease;
}

a:hover {
  color: var(--inline-links--hover);
  text-decoration: underline;
}

a:visited {
  color: var(--inline-links--visited);
}

/* Blockquotes */
blockquote {
  border-left: 4px solid var(--primary);
  background-color: var(--primary--extra-light);
  padding: var(--s-4) var(--s-5);
  margin: var(--s-5) 0;
  border-radius: 0 8px 8px 0;
}

blockquote p {
  margin-bottom: 0;
}

/* Lists */
ul, ol {
  margin-bottom: var(--s-4);
  padding-left: var(--s-5);
}

li {
  margin-bottom: var(--s-2);
  line-height: 1.6;
}

/* Nested lists */
ul ul, ol ol, ul ol, ol ul {
  margin-top: var(--s-2);
  margin-bottom: 0;
}

/* Task Lists */
ul.task-list {
  list-style: none;
  padding-left: 0;
}

ul.task-list li {
  padding-left: var(--s-1);
}

/* Inline code */
code {
  background-color: var(--neutral--light);
  padding: 0.15em 0.4em;
  border-radius: 4px;
  font-size: 0.9em;
  color: var(--tertiary--dark);
  font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
}

/* Code blocks */
pre {
  background-color: #f8f9fa;
  color: #333333;
  border: 1px solid var(--neutral--medium-light);
  padding: var(--s-4);
  border-radius: 8px;
  overflow-x: auto;
  margin: var(--s-5) 0;
  font-size: var(--b-xs);
  line-height: 1.5;
}

pre code {
  background-color: transparent;
  padding: 0;
  color: inherit;
}

/* Mermaid diagrams */
.mermaid {
  margin: var(--s-5) 0;
  text-align: center;
  background-color: var(--neutral--white);
  padding: var(--s-4);
  border-radius: 8px;
  border: 1px solid var(--neutral--medium-light);
}
  </style>
  <!-- ========== Prism.JS Syntax Highlighting ========== -->

  <!-- Prism theme (choose one theme below) -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism.css"
  />

  <!-- Core Prism library -->
  <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script>

  <!-- Add languages you need -->
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-csharp.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-json.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-sql.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-typescript.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-yaml.js"></script>

  <!-- Automatically highlight code after page load -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      if (window.Prism) {
        Prism.highlightAll();
      }
    });
  </script>

  <!-- ========== Mermaid Rendering ========== -->

  <!-- Use stable UMD build -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Find code blocks that came from ```mermaid fences
      const mermaidCodeBlocks = document.querySelectorAll(
        'pre.mermaid > code, pre > code.language-mermaid'
      );

      mermaidCodeBlocks.forEach(code => {
        const pre = code.parentElement;
        const parent = pre?.parentElement;
        if (!pre || !parent) return;

        const text = (code.textContent || '').trim();
        if (!text) return;

        // Replace <pre><code> with <div class="mermaid">...</div>
        const div = document.createElement('div');
        div.className = 'mermaid';
        div.textContent = text;

        parent.replaceChild(div, pre);
      });

      mermaid.initialize({
        startOnLoad: true
      });
    });
  </script>
  <!-- Navigation CSS and JS -->
  <link rel="stylesheet" href="navigation.css" />
  <script src="navigation.js" defer></script>
</head>
<body>
<h1 id="azure-pem-infrastructure">Azure PEM Infrastructure</h1>
<p><strong>Version:</strong> 1.0<br />
<strong>Last Updated:</strong> January 15, 2026<br />
<strong>Author:</strong> Andy Bratton<br />
<strong>Status:</strong> Planning Phase<br />
<strong>Parent Document:</strong> <a
href="01-AZURE-PEM-MASTER-PLAN.html">01-AZURE-PEM-MASTER-PLAN.md</a></p>
<hr />
<h2 id="overview">Overview</h2>
<p>This document defines the Infrastructure as Code (IaC) approach for
Azure PEM using Terraform. All Azure resources are provisioned and
managed through Terraform, enabling consistent, repeatable deployments
across environments.</p>
<hr />
<h2 id="infrastructure-architecture">Infrastructure Architecture</h2>
<p><strong>Infrastructure Overview</strong></p>
<pre class="mermaid"><code>%%{init: {&#39;theme&#39;: &#39;default&#39;}}%%
flowchart LR
    subgraph TF[&quot;TERRAFORM CONFIGURATION&quot;]
        CONFIG[&quot;• shared-services/&lt;br/&gt;• compute/&lt;br/&gt;• modules/&quot;]
    end

    subgraph NONPROD[&quot;NON-PROD SUBSCRIPTION&quot;]
        subgraph SHARED[&quot;SHARED RESOURCES&quot;]
            SHARED_SVC[&quot;• Service Bus&lt;br/&gt;• SQL Server&lt;br/&gt;• Cosmos DB&lt;br/&gt;• Redis&lt;br/&gt;• Key Vault&quot;]
        end
        subgraph COMPUTE[&quot;COMPUTE&quot;]
            DEV[&quot;DEV COMPUTE&lt;br/&gt;• App Services&lt;br/&gt;• Functions&quot;]
            QAE[&quot;QAE COMPUTE&lt;br/&gt;• App Svcs&lt;br/&gt;• Functions&quot;]
        end
    end

    subgraph PROD[&quot;PROD SUBSCRIPTION&quot;]
        PROD_SVC[&quot;PROD (Zone-Redundant)&lt;br/&gt;• Service Bus Premium&lt;br/&gt;• SQL Business Critical&lt;br/&gt;• Cosmos DB (Zone-Redundant)&lt;br/&gt;• App Services Premium&quot;]
    end

    TF --&gt; NONPROD
    TF --&gt; PROD</code></pre>
<hr />
<h2 id="repository-structure">Repository Structure</h2>
<pre><code>azure-pem/
└── infrastructure/
    ├── terraform/
    │   ├── shared-services/           # Shared infrastructure
    │   │   ├── main.tf
    │   │   ├── variables.tf
    │   │   ├── outputs.tf
    │   │   ├── providers.tf
    │   │   └── environments/
    │   │       ├── nonprod.tfvars     # Shared: dev + qae
    │   │       ├── uat.tfvars         # Isolated UAT
    │   │       └── prod.tfvars        # Isolated Prod
    │   │
    │   ├── compute/                    # Per-environment compute
    │   │   ├── main.tf
    │   │   ├── variables.tf
    │   │   ├── outputs.tf
    │   │   ├── providers.tf
    │   │   └── environments/
    │   │       ├── dev.tfvars
    │   │       ├── qae.tfvars
    │   │       ├── uat.tfvars
    │   │       └── prod.tfvars
    │   │
    │   ├── modules/                    # Reusable modules
    │   │   ├── networking/
    │   │   ├── app-service/
    │   │   ├── function-app/
    │   │   ├── sql-database/
    │   │   ├── service-bus/
    │   │   ├── redis/
    │   │   ├── signalr/
    │   │   ├── key-vault/
    │   │   ├── app-configuration/
    │   │   ├── api-management/
    │   │   └── monitoring/
    │   │
    │   └── versions.tf                 # Provider versions
    │
    ├── scripts/
    │   ├── init-backend.sh            # Initialize Terraform backend
    │   ├── plan.sh                    # Run terraform plan
    │   └── apply.sh                   # Run terraform apply
    │
    └── README.md</code></pre>
<hr />
<h2 id="terraform-backend-configuration">Terraform Backend
Configuration</h2>
<p>State is stored in Azure Storage Account:</p>
<pre class="hcl"><code># providers.tf
terraform {
  required_version = &quot;&gt;= 1.5.0&quot;
  
  backend &quot;azurerm&quot; {
    resource_group_name  = &quot;rg-pem-tfstate&quot;
    storage_account_name = &quot;stpemtfstate&quot;
    container_name       = &quot;tfstate&quot;
    key                  = &quot;pem.tfstate&quot;  # Varies per configuration
  }
  
  required_providers {
    azurerm = {
      source  = &quot;hashicorp/azurerm&quot;
      version = &quot;~&gt; 3.85&quot;
    }
    azuread = {
      source  = &quot;hashicorp/azuread&quot;
      version = &quot;~&gt; 2.47&quot;
    }
  }
}

provider &quot;azurerm&quot; {
  features {
    key_vault {
      purge_soft_delete_on_destroy = false
    }
  }
}</code></pre>
<hr />
<h2 id="module-app-service">Module: App Service</h2>
<pre class="hcl"><code># modules/app-service/main.tf

variable &quot;name&quot; {
  type = string
}

variable &quot;resource_group_name&quot; {
  type = string
}

variable &quot;location&quot; {
  type = string
}

variable &quot;app_service_plan_id&quot; {
  type = string
}

variable &quot;dotnet_version&quot; {
  type    = string
  default = &quot;v10.0&quot;
}

variable &quot;app_settings&quot; {
  type    = map(string)
  default = {}
}

variable &quot;connection_strings&quot; {
  type = list(object({
    name  = string
    type  = string
    value = string
  }))
  default = []
}

variable &quot;is_zone_redundant&quot; {
  type    = bool
  default = false
}

variable &quot;tags&quot; {
  type    = map(string)
  default = {}
}

resource &quot;azurerm_linux_web_app&quot; &quot;this&quot; {
  name                = var.name
  resource_group_name = var.resource_group_name
  location            = var.location
  service_plan_id     = var.app_service_plan_id
  
  https_only = true
  
  site_config {
    always_on         = true
    ftps_state        = &quot;Disabled&quot;
    http2_enabled     = true
    minimum_tls_version = &quot;1.2&quot;
    
    application_stack {
      dotnet_version = var.dotnet_version
    }
    
    health_check_path = &quot;/health&quot;
  }
  
  app_settings = merge(var.app_settings, {
    &quot;APPLICATIONINSIGHTS_CONNECTION_STRING&quot; = var.app_insights_connection_string
    &quot;ASPNETCORE_ENVIRONMENT&quot;                = var.environment
  })
  
  dynamic &quot;connection_string&quot; {
    for_each = var.connection_strings
    content {
      name  = connection_string.value.name
      type  = connection_string.value.type
      value = connection_string.value.value
    }
  }
  
  identity {
    type = &quot;SystemAssigned&quot;
  }
  
  tags = var.tags
}

output &quot;id&quot; {
  value = azurerm_linux_web_app.this.id
}

output &quot;default_hostname&quot; {
  value = azurerm_linux_web_app.this.default_hostname
}

output &quot;principal_id&quot; {
  value = azurerm_linux_web_app.this.identity[0].principal_id
}</code></pre>
<hr />
<h2 id="module-sql-database">Module: SQL Database</h2>
<pre class="hcl"><code># modules/sql-database/main.tf

variable &quot;server_name&quot; {
  type = string
}

variable &quot;database_name&quot; {
  type = string
}

variable &quot;resource_group_name&quot; {
  type = string
}

variable &quot;location&quot; {
  type = string
}

variable &quot;sku_name&quot; {
  type    = string
  default = &quot;GP_Gen5_2&quot;  # General Purpose, 2 vCores
}

variable &quot;max_size_gb&quot; {
  type    = number
  default = 100
}

variable &quot;zone_redundant&quot; {
  type    = bool
  default = false
}

variable &quot;admin_login&quot; {
  type      = string
  sensitive = true
}

variable &quot;admin_password&quot; {
  type      = string
  sensitive = true
}

variable &quot;tags&quot; {
  type    = map(string)
  default = {}
}

resource &quot;azurerm_mssql_server&quot; &quot;this&quot; {
  name                         = var.server_name
  resource_group_name          = var.resource_group_name
  location                     = var.location
  version                      = &quot;12.0&quot;
  administrator_login          = var.admin_login
  administrator_login_password = var.admin_password
  minimum_tls_version          = &quot;1.2&quot;
  
  azuread_administrator {
    login_username = &quot;pem-sql-admins&quot;
    object_id      = var.sql_admin_group_id
  }
  
  identity {
    type = &quot;SystemAssigned&quot;
  }
  
  tags = var.tags
}

resource &quot;azurerm_mssql_database&quot; &quot;this&quot; {
  name                        = var.database_name
  server_id                   = azurerm_mssql_server.this.id
  sku_name                    = var.sku_name
  max_size_gb                 = var.max_size_gb
  zone_redundant              = var.zone_redundant
  storage_account_type        = var.zone_redundant ? &quot;Zone&quot; : &quot;Local&quot;
  
  short_term_retention_policy {
    retention_days           = var.zone_redundant ? 35 : 7
    backup_interval_in_hours = 12
  }
  
  long_term_retention_policy {
    weekly_retention  = var.zone_redundant ? &quot;P4W&quot; : null
    monthly_retention = var.zone_redundant ? &quot;P12M&quot; : null
  }
  
  tags = var.tags
}

# Firewall rules
resource &quot;azurerm_mssql_firewall_rule&quot; &quot;azure_services&quot; {
  name             = &quot;AllowAzureServices&quot;
  server_id        = azurerm_mssql_server.this.id
  start_ip_address = &quot;0.0.0.0&quot;
  end_ip_address   = &quot;0.0.0.0&quot;
}

output &quot;server_id&quot; {
  value = azurerm_mssql_server.this.id
}

output &quot;server_fqdn&quot; {
  value = azurerm_mssql_server.this.fully_qualified_domain_name
}

output &quot;database_id&quot; {
  value = azurerm_mssql_database.this.id
}

output &quot;connection_string&quot; {
  value     = &quot;Server=tcp:${azurerm_mssql_server.this.fully_qualified_domain_name},1433;Database=${azurerm_mssql_database.this.name};Authentication=Active Directory Default;&quot;
  sensitive = true
}</code></pre>
<hr />
<h2 id="module-service-bus">Module: Service Bus</h2>
<pre class="hcl"><code># modules/service-bus/main.tf

variable &quot;name&quot; {
  type = string
}

variable &quot;resource_group_name&quot; {
  type = string
}

variable &quot;location&quot; {
  type = string
}

variable &quot;sku&quot; {
  type    = string
  default = &quot;Standard&quot;  # Standard or Premium
}

variable &quot;zone_redundant&quot; {
  type    = bool
  default = false
}

variable &quot;queues&quot; {
  type = list(object({
    name                = string
    max_delivery_count  = optional(number, 10)
    lock_duration       = optional(string, &quot;PT1M&quot;)
  }))
  default = []
}

variable &quot;topics&quot; {
  type = list(object({
    name = string
    subscriptions = list(object({
      name               = string
      max_delivery_count = optional(number, 10)
    }))
  }))
  default = []
}

variable &quot;tags&quot; {
  type    = map(string)
  default = {}
}

resource &quot;azurerm_servicebus_namespace&quot; &quot;this&quot; {
  name                = var.name
  resource_group_name = var.resource_group_name
  location            = var.location
  sku                 = var.sku
  zone_redundant      = var.zone_redundant &amp;&amp; var.sku == &quot;Premium&quot;
  
  capacity = var.sku == &quot;Premium&quot; ? 1 : 0
  
  identity {
    type = &quot;SystemAssigned&quot;
  }
  
  tags = var.tags
}

resource &quot;azurerm_servicebus_queue&quot; &quot;queues&quot; {
  for_each = { for q in var.queues : q.name =&gt; q }
  
  name                = each.value.name
  namespace_id        = azurerm_servicebus_namespace.this.id
  max_delivery_count  = each.value.max_delivery_count
  lock_duration       = each.value.lock_duration
  dead_lettering_on_message_expiration = true
}

resource &quot;azurerm_servicebus_topic&quot; &quot;topics&quot; {
  for_each = { for t in var.topics : t.name =&gt; t }
  
  name         = each.value.name
  namespace_id = azurerm_servicebus_namespace.this.id
}

resource &quot;azurerm_servicebus_subscription&quot; &quot;subscriptions&quot; {
  for_each = {
    for item in flatten([
      for topic in var.topics : [
        for sub in topic.subscriptions : {
          topic_name = topic.name
          sub_name   = sub.name
          max_delivery_count = sub.max_delivery_count
        }
      ]
    ]) : &quot;${item.topic_name}-${item.sub_name}&quot; =&gt; item
  }
  
  name                = each.value.sub_name
  topic_id            = azurerm_servicebus_topic.topics[each.value.topic_name].id
  max_delivery_count  = each.value.max_delivery_count
}

output &quot;namespace_id&quot; {
  value = azurerm_servicebus_namespace.this.id
}

output &quot;namespace_name&quot; {
  value = azurerm_servicebus_namespace.this.name
}

output &quot;primary_connection_string&quot; {
  value     = azurerm_servicebus_namespace.this.default_primary_connection_string
  sensitive = true
}</code></pre>
<hr />
<h2 id="shared-services-configuration">Shared Services
Configuration</h2>
<pre class="hcl"><code># shared-services/main.tf

locals {
  common_tags = {
    Project     = &quot;Azure-PEM&quot;
    Environment = var.environment
    ManagedBy   = &quot;Terraform&quot;
  }
}

# Resource Group
resource &quot;azurerm_resource_group&quot; &quot;shared&quot; {
  name     = &quot;rg-pem-shared-${var.environment}&quot;
  location = var.location
  tags     = local.common_tags
}

# SQL Server + Databases
module &quot;sql&quot; {
  source = &quot;../modules/sql-database&quot;
  
  server_name         = &quot;sql-pem-${var.environment}&quot;
  database_name       = &quot;pem-db-${var.environment}&quot;
  resource_group_name = azurerm_resource_group.shared.name
  location            = var.location
  
  sku_name       = var.sql_sku
  max_size_gb    = var.sql_max_size_gb
  zone_redundant = var.is_production
  
  admin_login    = var.sql_admin_login
  admin_password = var.sql_admin_password
  sql_admin_group_id = var.sql_admin_group_id
  
  tags = local.common_tags
}

# Service Bus
module &quot;service_bus&quot; {
  source = &quot;../modules/service-bus&quot;
  
  name                = &quot;sb-pem-${var.environment}&quot;
  resource_group_name = azurerm_resource_group.shared.name
  location            = var.location
  
  sku            = var.is_production ? &quot;Premium&quot; : &quot;Standard&quot;
  zone_redundant = var.is_production
  
  queues = [
    { name = &quot;episode-processing&quot; },
    { name = &quot;bundle-calculation&quot; },
    { name = &quot;claim-ingestion&quot; }
  ]
  
  topics = [
    {
      name = &quot;episode-events&quot;
      subscriptions = [
        { name = &quot;notification-handler&quot; },
        { name = &quot;audit-handler&quot; }
      ]
    }
  ]
  
  tags = local.common_tags
}

# Redis Cache
module &quot;redis&quot; {
  source = &quot;../modules/redis&quot;
  
  name                = &quot;redis-pem-${var.environment}&quot;
  resource_group_name = azurerm_resource_group.shared.name
  location            = var.location
  
  sku_name       = var.is_production ? &quot;Premium&quot; : &quot;Basic&quot;
  family         = var.is_production ? &quot;P&quot; : &quot;C&quot;
  capacity       = var.is_production ? 1 : 0
  zone_redundant = var.is_production
  
  tags = local.common_tags
}

# Key Vault
module &quot;key_vault&quot; {
  source = &quot;../modules/key-vault&quot;
  
  name                = &quot;kv-pem-${var.environment}&quot;
  resource_group_name = azurerm_resource_group.shared.name
  location            = var.location
  
  tags = local.common_tags
}

# App Configuration (Feature Flags)
module &quot;app_configuration&quot; {
  source = &quot;../modules/app-configuration&quot;
  
  name                = &quot;appconfig-pem-${var.environment}&quot;
  resource_group_name = azurerm_resource_group.shared.name
  location            = var.location
  
  sku = var.is_production ? &quot;standard&quot; : &quot;free&quot;
  
  tags = local.common_tags
}

# SignalR Service
module &quot;signalr&quot; {
  source = &quot;../modules/signalr&quot;
  
  name                = &quot;signalr-pem-${var.environment}&quot;
  resource_group_name = azurerm_resource_group.shared.name
  location            = var.location
  
  sku_name = var.is_production ? &quot;Premium_P1&quot; : &quot;Free_F1&quot;
  
  tags = local.common_tags
}

# Application Insights
module &quot;monitoring&quot; {
  source = &quot;../modules/monitoring&quot;
  
  name                = &quot;appi-pem-${var.environment}&quot;
  resource_group_name = azurerm_resource_group.shared.name
  location            = var.location
  
  tags = local.common_tags
}</code></pre>
<hr />
<h2 id="environment-variables">Environment Variables</h2>
<h3 id="nonprod.tfvars">nonprod.tfvars</h3>
<pre class="hcl"><code>environment    = &quot;nonprod&quot;
location       = &quot;eastus2&quot;
is_production  = false

# SQL
sql_sku         = &quot;GP_Gen5_2&quot;
sql_max_size_gb = 100

# Outputs used by dev and qae compute</code></pre>
<h3 id="prod.tfvars">prod.tfvars</h3>
<pre class="hcl"><code>environment    = &quot;prod&quot;
location       = &quot;eastus2&quot;
is_production  = true

# SQL - Business Critical for zone redundancy
sql_sku         = &quot;BC_Gen5_8&quot;
sql_max_size_gb = 500</code></pre>
<hr />
<h2 id="compute-configuration">Compute Configuration</h2>
<pre class="hcl"><code># compute/main.tf

locals {
  common_tags = {
    Project     = &quot;Azure-PEM&quot;
    Environment = var.environment
    ManagedBy   = &quot;Terraform&quot;
  }
}

# Resource Group
resource &quot;azurerm_resource_group&quot; &quot;compute&quot; {
  name     = &quot;rg-pem-${var.environment}&quot;
  location = var.location
  tags     = local.common_tags
}

# App Service Plan
resource &quot;azurerm_service_plan&quot; &quot;main&quot; {
  name                = &quot;asp-pem-${var.environment}&quot;
  resource_group_name = azurerm_resource_group.compute.name
  location            = var.location
  os_type             = &quot;Linux&quot;
  sku_name            = var.app_service_sku
  
  zone_balancing_enabled = var.is_production
  worker_count           = var.is_production ? 3 : 1
  
  tags = local.common_tags
}

# API Services
module &quot;api_episodes&quot; {
  source = &quot;../modules/app-service&quot;
  
  name                = &quot;app-pem-episodes-${var.environment}&quot;
  resource_group_name = azurerm_resource_group.compute.name
  location            = var.location
  app_service_plan_id = azurerm_service_plan.main.id
  
  app_settings = {
    &quot;ConnectionStrings__DefaultConnection&quot; = data.azurerm_key_vault_secret.sql_connection.value
    &quot;ServiceBus__ConnectionString&quot;         = data.azurerm_key_vault_secret.servicebus_connection.value
    &quot;Redis__ConnectionString&quot;              = data.azurerm_key_vault_secret.redis_connection.value
    &quot;AppConfig__Endpoint&quot;                  = data.terraform_remote_state.shared.outputs.app_config_endpoint
  }
  
  tags = local.common_tags
}

module &quot;api_definitions&quot; {
  source = &quot;../modules/app-service&quot;
  
  name                = &quot;app-pem-definitions-${var.environment}&quot;
  resource_group_name = azurerm_resource_group.compute.name
  location            = var.location
  app_service_plan_id = azurerm_service_plan.main.id
  
  app_settings = {
    &quot;ConnectionStrings__DefaultConnection&quot; = data.azurerm_key_vault_secret.sql_connection.value
  }
  
  tags = local.common_tags
}

module &quot;api_modeling&quot; {
  source = &quot;../modules/app-service&quot;
  
  name                = &quot;app-pem-modeling-${var.environment}&quot;
  resource_group_name = azurerm_resource_group.compute.name
  location            = var.location
  app_service_plan_id = azurerm_service_plan.main.id
  
  app_settings = {
    &quot;ConnectionStrings__DefaultConnection&quot; = data.azurerm_key_vault_secret.sql_connection.value
    &quot;ServiceBus__ConnectionString&quot;         = data.azurerm_key_vault_secret.servicebus_connection.value
  }
  
  tags = local.common_tags
}

# Azure Functions
module &quot;workers&quot; {
  source = &quot;../modules/function-app&quot;
  
  name                = &quot;func-pem-workers-${var.environment}&quot;
  resource_group_name = azurerm_resource_group.compute.name
  location            = var.location
  
  app_service_plan_id = var.is_production ? azurerm_service_plan.premium.id : null
  consumption_plan    = !var.is_production
  
  app_settings = {
    &quot;ConnectionStrings__DefaultConnection&quot; = data.azurerm_key_vault_secret.sql_connection.value
    &quot;ServiceBus__ConnectionString&quot;         = data.azurerm_key_vault_secret.servicebus_connection.value
  }
  
  tags = local.common_tags
}</code></pre>
<hr />
<h2 id="cicd-pipeline-integration">CI/CD Pipeline Integration</h2>
<div class="sourceCode" id="cb11"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># .azure/pipelines/cd-infrastructure.yml</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">trigger</span><span class="kw">:</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">branches</span><span class="kw">:</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">include</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">main</span><span class="kw">]</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">paths</span><span class="kw">:</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">include</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">infrastructure/</span><span class="ot">**]</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="fu">parameters</span><span class="kw">:</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="at">  - </span><span class="fu">name</span><span class="kw">:</span><span class="at"> environment</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="at">    displayName: Target Environment</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="at">    type: string</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="at">    default: dev</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="at">    values: [dev</span><span class="kw">,</span><span class="at"> qae</span><span class="kw">,</span><span class="at"> uat</span><span class="kw">,</span><span class="at"> prod</span><span class="kw">]</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="fu">variables</span><span class="kw">:</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">group</span><span class="kw">:</span><span class="at"> pem-terraform-${{ parameters.environment }}</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="fu">stages</span><span class="kw">:</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> Plan</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">job</span><span class="kw">:</span><span class="at"> TerraformPlan</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">task</span><span class="kw">:</span><span class="at"> TerraformInstaller@0</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">inputs</span><span class="kw">:</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">terraformVersion</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;1.5.x&#39;</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="at">          </span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="kw">          - </span><span class="fu">script</span><span class="kw">:</span><span class="at"> </span><span class="ch">|</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>              cd infrastructure/terraform/compute</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>              terraform init \</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>                -backend-config=&quot;key=${{ parameters.environment }}.tfstate&quot;</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>              terraform plan \</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>                -var-file=&quot;environments/${{ parameters.environment }}.tfvars&quot; \</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>                -out=tfplan</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">displayName</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;Terraform Plan&#39;</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="at">          </span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">publish</span><span class="kw">:</span><span class="at"> infrastructure/terraform/compute/tfplan</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">artifact</span><span class="kw">:</span><span class="at"> tfplan</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> Apply</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">dependsOn</span><span class="kw">:</span><span class="at"> Plan</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">condition</span><span class="kw">:</span><span class="at"> and(succeeded(), eq(variables[&#39;Build.SourceBranch&#39;], &#39;refs/heads/main&#39;))</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">deployment</span><span class="kw">:</span><span class="at"> TerraformApply</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">environment</span><span class="kw">:</span><span class="at"> pem-${{ parameters.environment }}</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">strategy</span><span class="kw">:</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">runOnce</span><span class="kw">:</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">deploy</span><span class="kw">:</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="kw">-</span><span class="at"> </span><span class="fu">download</span><span class="kw">:</span><span class="at"> current</span></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a><span class="at">                  </span><span class="fu">artifact</span><span class="kw">:</span><span class="at"> tfplan</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a><span class="at">                </span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a><span class="kw">                - </span><span class="fu">script</span><span class="kw">:</span><span class="at"> </span><span class="ch">|</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>                    cd infrastructure/terraform/compute</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>                    terraform init \</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>                      -backend-config=&quot;key=${{ parameters.environment }}.tfstate&quot;</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>                    terraform apply -auto-approve ../tfplan</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a><span class="at">                  </span><span class="fu">displayName</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;Terraform Apply&#39;</span></span></code></pre></div>
<hr />
<h2 id="cost-optimization">Cost Optimization</h2>
<table>
<thead>
<tr>
<th>Resource</th>
<th>Dev/QAE Strategy</th>
<th>UAT Strategy</th>
<th>Prod Strategy</th>
</tr>
</thead>
<tbody>
<tr>
<td>App Service</td>
<td>Basic B2</td>
<td>Standard S2</td>
<td>Premium P2v3</td>
</tr>
<tr>
<td>SQL</td>
<td>GP 2 vCore (shared)</td>
<td>GP 4 vCore</td>
<td>BC 8 vCore (ZR)</td>
</tr>
<tr>
<td>Redis</td>
<td>Basic C0 (shared)</td>
<td>Standard C1</td>
<td>Premium P1 (ZR)</td>
</tr>
<tr>
<td>Service Bus</td>
<td>Standard (shared)</td>
<td>Standard</td>
<td>Premium (ZR)</td>
</tr>
<tr>
<td>Functions</td>
<td>Consumption</td>
<td>Consumption</td>
<td>Premium EP2 (ZR)</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="related-documents">Related Documents</h2>
<ul>
<li><a
href="01-AZURE-PEM-MASTER-PLAN.html">01-AZURE-PEM-MASTER-PLAN.md</a> -
Project overview</li>
<li><a href="02-AZURE-ARCHITECTURE.html">02-AZURE-ARCHITECTURE.md</a> -
Architecture details</li>
</ul>
<hr />
<p><strong>Document Status:</strong> ✅ Complete<br />
<strong>Next Steps:</strong> Implement Terraform modules, test in dev
environment</p>
</body>
</html>
